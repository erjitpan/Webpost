---
-  hosts: dpmawp
   tasks:
     - include_vars: vars.yml
       vars:
         webpost_file: "{{ webpost_file }}"
         
     - name: Check that the {{ webpost_file }} exists
       win_stat:
         path: C:\Websites\dpmawp.itsupport247.net\{{ webpost_file }}
       register: stat_result

     - name: Copy file to Backup location
       win_copy:
         src: C:\Websites\dpmawp.itsupport247.net\{{ webpost_file }}
         dest: C:\Websites\Backup\
       when: stat_result.stat.exists
         #remote_src: True

     - name: Delete file After Backup
       win_file:
         path: C:\Websites\dpmawp.itsupport247.net\{{ webpost_file }} and C:\Websites\http.dpmawp.itsupport247.net\{{ webpost_file }}
         state: absent
         when: webpost_file.stat.exists
         
     - name: Copy webpost file
       win_copy:
         src: /var/lib/jenkins/workspace/Webpost/{{ webpost_file }}
         dest: "{{ item }}"
       with_items:
         - "{{ dpmawp.destination3 }}"
         - "{{ dpmawp.destination4 }}"

